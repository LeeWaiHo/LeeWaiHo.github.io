<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<title>
搭建NFS服务器并应用于Docker Volume - Winho Lee
</title>











<link rel="stylesheet" href="/css/main.min.81bbafc4df93b11c1c3e2449464373c384aa4903731b4fc7a77dfcdd979e184f.css" integrity="sha256-gbuvxN&#43;TsRwcPiRJRkNzw4SqSQNzG0/Hp3383ZeeGE8=" crossorigin="anonymous" media="screen">



 

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="搭建NFS服务器并应用于Docker Volume"/>
<meta name="twitter:description" content="背景 希望能有一个结构清晰的文件系统供docker容器挂卷使用
环境 系统: CentOS7 内核: 3.10.0-1062.1.1.el7.x86_64
前提 安装好nfs相关组件 yum -y install nfs-utils  指定NFS匿名用户 创建操作系统用户组 groupadd data
创建操作系统用户 useradd -M -G data storage-manager -s /sbin/nologin
配置NFS卷 配置exports文件 vim /etc/exports 打开exports文件 输入如下配置
/storage 10.20.0.0/24(rw,insecure,all_squash,no_subtree_check,anonuid=1000,anongid=1000)   /storage 挂载的目录 10.20.0.0/24 允许访问的机器(机器名orCIDR) (rw,insecure,all_squash,no_subtree_check,anonuid=1000,anongid=1000) 可读写,允许客户端使用1024以上端口访问, 所有访问者都被映射成nfs的anonymous用户, 如果用户能访问当前目录, 那么也能访问子目录, 指定anonymous用户在当前系统的用户uid和gid  刷新exports配置 exportfs -r
查看本地exports配置 exportfs -v
查看远程NFS服务器的卷 showmount -e 10.20.0.1
拓展 docker volume使用nfs驱动 注意前提是 docker ce版本大于17.06
参考资料: https://docs.docker.com/engine/reference/commandline/volume_create/
docker volume create --driver local \ -o type=nfs \ -o o=addr=10."/>

<meta property="og:title" content="搭建NFS服务器并应用于Docker Volume" />
<meta property="og:description" content="背景 希望能有一个结构清晰的文件系统供docker容器挂卷使用
环境 系统: CentOS7 内核: 3.10.0-1062.1.1.el7.x86_64
前提 安装好nfs相关组件 yum -y install nfs-utils  指定NFS匿名用户 创建操作系统用户组 groupadd data
创建操作系统用户 useradd -M -G data storage-manager -s /sbin/nologin
配置NFS卷 配置exports文件 vim /etc/exports 打开exports文件 输入如下配置
/storage 10.20.0.0/24(rw,insecure,all_squash,no_subtree_check,anonuid=1000,anongid=1000)   /storage 挂载的目录 10.20.0.0/24 允许访问的机器(机器名orCIDR) (rw,insecure,all_squash,no_subtree_check,anonuid=1000,anongid=1000) 可读写,允许客户端使用1024以上端口访问, 所有访问者都被映射成nfs的anonymous用户, 如果用户能访问当前目录, 那么也能访问子目录, 指定anonymous用户在当前系统的用户uid和gid  刷新exports配置 exportfs -r
查看本地exports配置 exportfs -v
查看远程NFS服务器的卷 showmount -e 10.20.0.1
拓展 docker volume使用nfs驱动 注意前提是 docker ce版本大于17.06
参考资料: https://docs.docker.com/engine/reference/commandline/volume_create/
docker volume create --driver local \ -o type=nfs \ -o o=addr=10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://liweihao.me/posts/create-nfs-server/" />
<meta property="article:published_time" content="2019-10-09T14:52:24+08:00" />
<meta property="article:modified_time" content="2019-10-09T14:52:24+08:00" />


    

    
    
    
    <title>
        
        搭建NFS服务器并应用于Docker Volume
        
    </title>
</head>

<body>
    <div class="wrap">
        <div class="section" id="title">搭建NFS服务器并应用于Docker Volume</div>

        
<div class="section" id="content">
    Wed Oct 09, 2019 &#183; 77 words
    
    <hr/>
    

<h2 id="背景">背景</h2>

<p>希望能有一个结构清晰的文件系统供docker容器挂卷使用</p>

<h2 id="环境">环境</h2>

<p>系统: CentOS7
内核: 3.10.0-1062.1.1.el7.x86_64</p>

<h2 id="前提">前提</h2>

<h3 id="安装好nfs相关组件">安装好nfs相关组件</h3>

<pre><code class="language-bash">yum -y install nfs-utils
</code></pre>

<h3 id="指定nfs匿名用户">指定NFS匿名用户</h3>

<h4 id="创建操作系统用户组">创建操作系统用户组</h4>

<p><code>groupadd data</code></p>

<h4 id="创建操作系统用户">创建操作系统用户</h4>

<p><code>useradd -M -G data storage-manager -s /sbin/nologin</code></p>

<h3 id="配置nfs卷">配置NFS卷</h3>

<h4 id="配置exports文件">配置exports文件</h4>

<p><code>vim /etc/exports</code> 打开exports文件 输入如下配置</p>

<pre><code>/storage 10.20.0.0/24(rw,insecure,all_squash,no_subtree_check,anonuid=1000,anongid=1000)
</code></pre>

<ul>
<li><code>/storage</code> 挂载的目录</li>
<li><code>10.20.0.0/24</code> 允许访问的机器(机器名or<code>CIDR</code>)</li>
<li><code>(rw,insecure,all_squash,no_subtree_check,anonuid=1000,anongid=1000)</code> 可读写,允许客户端使用<code>1024</code>以上端口访问, 所有访问者都被映射成nfs的anonymous用户, 如果用户能访问当前目录, 那么也能访问子目录, 指定anonymous用户在当前系统的用户uid和gid</li>
</ul>

<h4 id="刷新exports配置">刷新exports配置</h4>

<p><code>exportfs -r</code></p>

<h4 id="查看本地exports配置">查看本地exports配置</h4>

<p><code>exportfs -v</code></p>

<h4 id="查看远程nfs服务器的卷">查看远程NFS服务器的卷</h4>

<p><code>showmount -e 10.20.0.1</code></p>

<h2 id="拓展">拓展</h2>

<h3 id="docker-volume使用nfs驱动">docker volume使用nfs驱动</h3>

<p>注意前提是 docker ce版本大于17.06</p>

<p>参考资料: <a href="https://docs.docker.com/engine/reference/commandline/volume_create/">https://docs.docker.com/engine/reference/commandline/volume_create/</a></p>

<pre><code class="language-bash">docker volume create --driver local \
        -o type=nfs \
        -o o=addr=10.20.0.1,rw \
        -o device=:/storeage/logs \
        logs-volume
</code></pre>

</div>


        
<div class="section bottom-menu">
    

    
        <a href="/posts">back</a>
        
    

    
</p>
</div>


        <div class="section footer"></div>
    </div>
</body>

</html>